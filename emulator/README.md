# Эмулятор BigQuery

Эмулятор BigQuery позволяет локально запустить приближённый аналог данного хранилища, 
основная инструкция актуальна [cloud/README.md](../cloud/README.md), кроме авторизации.

Аналогичные примеры подключения и использования в go находятся находятся в данной папке.

Для запуска: `go run . [--kind=grpc]`

Также в файле `docker-compose.yml` находится пример запуска эмулятора в контейнере

Ошибки и недочёты выявленные мной, которые стоит учесть при работе с эмулятором:
1. При десериализации Arrow схемы не надо записывать в буфер схему, каждый батч и так её содержит [./grpc.go#L246](./grpc.go#L246).
    Issue: https://github.com/goccy/bigquery-emulator/issues/398
2. Создать датасет в эмуляторе с помощью `create schema` нельзя, поэтому нужно указывать датасет при запуске эмулятора 
    параметром `-dataset`. Однако, если подключить volume - повторные запуски будут с ошибкой. 
    Вариант решения: не создавать volume.
    Issue: https://github.com/goccy/bigquery-emulator/issues/397
3. Если создать поле с типом массива (array) и попытаться прочитать его в Arrow формате с помощью grpc API, эмулятор сломается.
    К сожалению массивы таким образом пока не за-select-ить
    Issue: https://github.com/goccy/bigquery-emulator/issues/399